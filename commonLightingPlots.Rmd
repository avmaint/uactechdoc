```{r clprefpoints}
#stage and room reference points
stage.refs <- tribble(
~group, ~name, ~type,        ~x,      ~y,      ~z,   ~notes,
"ref",     "r1",    "ref", 0,        0,       0,       "",
"ref",     "r2",    "ref", 0,       28+8/12,  0,       "",
"ref",     "r3",    "ref", 10+8/12, 0,        0,       "",
"ref",     "r4",    "ref", 10+8/12, 28+8/12, 0,        "",
"ref",     "r5",    "ref", 40+6/12,      0,        0,  "",
"ref",     "r6",    "ref", 25.8,    14.4,     0,       "position guessed"
)

room.refs <- tribble(
~group, ~name, ~type,        ~x,      ~y,      ~z,   ~notes,
 "ref",     "r7",    "ref", (123+6/12)/2, -23-2/12, 0,  "",
 "ref",     "r8",    "ref", (45+2/12)/2, -(90+2/12)+(28+8/12), 0,"",
 "ref",     "r9",    "ref", 0,   -(90+2/12)+(28+8/12), 0,"" 
)

thrust.refs <- tribble(
~group, ~name, ~type,        ~x,      ~y,      ~z,   ~notes,
 "ref",     "r7",    "ref", (123+6/12)/2, -23-2/12, 0,  "",
 "ref",     "r8",    "ref", (45+2/12)/2, -(90+2/12)+(28+8/12), 0,"",
 "ref",     "r9",    "ref", 0,   -(90+2/12)+(28+8/12), 0,"" 
)

balcony.refs <- tribble(
  ~group, ~name, ~type,        ~x,      ~y,      ~z,   ~notes,
  "balcony", "b1", "ref",       35,    -50,       0,  "position guessed",
  "balcony", "b2", "ref",       35,    -25,       0,  "position guessed",
  "balcony", "b3", "ref",       20,    -35,       0,  "position guessed",
  "balcony", "b4", "ref",       12,    -35,       0,  "position guessed",
  "balcony", "b5", "ref",        6,    -31,       0,  "position guessed"
)
```

```{r walls}
all.refs <- rbind(stage.refs, room.refs, balcony.refs)

wall <- function(p1, p2) {
  a <- all.refs[all.refs$name==p1,] %>% select(x,y)
  b <- all.refs[all.refs$name==p2,] %>% rename(xend=x, yend=y) %>% select(xend, yend)
  return( cbind(a, b))
}

wall.flip1 <- function(p1,p2) {
  a <- all.refs[all.refs$name==p1,] %>% select(x,y)  
  b <- all.refs[all.refs$name==p2,] %>% mutate(xend = -x, yend=y) %>% select(xend, yend) 
  return( cbind(a, b))
}

wall.flip2 <- function(p1,p2) {
  a <- all.refs[all.refs$name==p1,] %>% mutate(x = -x, y=y) %>% select(x,y)  
  b <- all.refs[all.refs$name==p2,] %>% mutate(xend = -x, yend=y) %>% select(xend, yend) 
  return( cbind(a, b))
}

s.wall  <- wall.flip1("r4","r4")  
sw.wall <- wall("r4", "r7") 
nw.wall <- wall("r7", "r8")
n.wall  <- wall.flip1("r8","r8")  
ne.wall <- wall.flip2("r8", "r7")
se.wall <- wall.flip2("r7", "r4")
stage1  <- wall("r6","r3")
stage2  <- wall.flip1("r3","r3")
stage3  <- wall.flip2("r6","r3")

wall.segments <- rbind(s.wall, sw.wall, nw.wall, n.wall, ne.wall, se.wall, stage1, stage2, stage3)

stage.segments <- rbind(stage1, stage2, stage3, s.wall,
                        wall("r4", "r6"),
                        wall.flip2("r4", "r6")
                        )
thrust <- wall.flip1("r3","r3")
#geom_curve(data=thrust, aes(x=x,y=y, xend=xend, yend=yend), curvature=-0.5)
```

```{r balconywalls}
b1.wall <- wall("b1" , "b2")
b2.wall <- wall("b2" , "b3")
b3.wall <- wall("b3", "b4")
b4.wall <- wall("b4", "b5")
b5.wall <- wall.flip1("b5", "b5")
b6.wall <- wall.flip2("b4", "b5")
b7.wall <- wall.flip2("b3", "b4")
b8.wall <- wall.flip2("b2" , "b3")
b9.wall  <- wall.flip2("b1","b2")
balc.segments <- rbind(b1.wall,  b2.wall, b3.wall, 
                       b4.wall, b5.wall, b6.wall, 
                       b7.wall, b8.wall,b9.wall)

```


```{r allpots}
pots.w <- tribble(
~group, ~name, ~type,        ~x,      ~y,      ~z,   ~notes,
"Down Stage",     "w01",    "F",   17.5/12,  4+1/12, 19+6/12,  "",
"Down Stage",     "w02",    "F",   68/12,    4+3/12, 19+5/12,  "",
"Down Stage",     "w03",    "F",   119.5/12, 6+6/12, 19+7/12,  "5-10 from edge on curve",
"Down Stage",     "w04",    "F",   179.5/12, 11+2/12, 19+7/12, "4-10 from front edge",
"Wall",     "w05",    "S",   239/12,   15+8/12, 19+6/12, 
                                        "2-10 from side wall. y guessed",
"Mid Stage",     "w06",    "F",   27/12,    9+1/12,  22+1/12, "",
"Mid Stage",     "w07",    "F",   87.5/12,  10+5/12, 21+12/12, "",
"Centre1",     "w08",    "VWF",   11/12,    13+6/12, 21+2/12,  "",
"Centre2",     "w09",    "VWF",   60.5/12,  14+1/12, 21,       "",
"Centre3",     "w10",   "VWF",   118/12,   16+3/12, 20+5/12,  "",
"Wall",     "w11",   "S",   14+8/12,  20+4/12, 18+2/12,  
                "y guessed. 14 inch riser. 2-3 from wall"  ,
"Up Stage",     "w12",   "WF",   23/12,    18+6/12, 19+4/12, "7 inch riser",
"Up Stage",     "w13",   "WF",   87/12,    20+2/12, 19+4/12, "14 inch riser",
"Wall",     "w14",   "S",   125/12,   25+8/12, 16+2/12, "28 inch riser",
"Wall",     "w15",   "S",   44/12,    25+9/12, 16+2/12, "")

pots.e <- pots.w %>%
        filter(type != "ref") %>%
        mutate( x = -x) %>%
        mutate (name = gsub(  "w", "e", name,  fixed=TRUE)) 

all.pots <- rbind(pots.e, pots.w)
```



#Lighting Plots

The several following diagrams in this section illustrate the physical layout of the lighting instruments and the related console channels that control that instrument. 

Each channel maps to one or more DMX addresses and is documented in the [DMX Details](#channel-and-dmx-details) section. 

These diagrams are approximations dimension wise.  Also someone simplified. The stage has some rounded corners at the front which are not depcited. As well the stage is not quite symmetrical. 

##Theartrical Channels
This first diagram shows full room and all theatrical fixtures, but excludes the architectural fixtures (i.e. Excludes house lights, stage pots, sconse, house pendants and under balcony pots.)

```{r clptchan, echo=FALSE}
  channels <-  dmx.details %>% filter(!is.na(x))

  g <- ggplot() + 
        geom_segment(data=wall.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 
        coord_equal() + #scale_size_identity() +
        geom_point(data=channels, aes(x=x, y=y, color=Type), size=2)  +
        geom_text(data=channels, aes(x=x, y=y, label=Channel), 
              nudge_x=channels$nx, nudge_y=channels$ny   ) +
        geom_segment(data=balc.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 
        geom_curve(data=thrust, aes(x=x,y=y, xend=xend, yend=yend), curvature=-0.5)

g
```

Zoom in on the stage. 

```{r clpzoomstage}
  channels <-  dmx.details %>% 
  filter(!is.na(x)) %>%
  filter(   between(Channel,18,48) | Channel == 77 )

ggplot() + 
  coord_equal() +
  geom_segment(data=stage.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 
  scale_size_identity() +
  geom_point(data=channels, aes(x=x, y=y, color=Type), size=8)  +
  geom_curve(data=thrust, aes(x=x,y=y, xend=xend, yend=yend), curvature=-0.5) +
  geom_text(data=channels, aes(x=x, y=y, label=Channel)    ) 
```


##Stage Pots

>TODO: Revist the details in light of a pending decision to collapse the three centre groups to a single group and channel.

```{r clpstagepots}
chs <- dmx.details %>% filter(Location == "Stage Pots") %>% select(Channel, Usage)
lox <- merge(chs, all.pots, by.x="Usage", by.y="group" )

ggplot() +
  geom_point(data=lox,              aes(x=x, y=y, color=Usage ), size=9) +
  geom_segment(data=stage.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 
  geom_text(data=lox, aes(x=x,y=y, label=Channel) ) +
  geom_curve(data=thrust, aes(x=x,y=y, xend=xend, yend=yend), curvature=-0.4) +
  coord_equal() + 
  ylim(-5,31) +
  scale_size_identity() 
```

##House Pendants

>TODO: Channels are not correct. Positions are only notional guesses and not complete. 

```{r clppendants, echo=FALSE}
pendants <- tribble(
  ~Channel, ~x,  ~y, ~sz,
  98,      -35,  -10,  1, 
  99,      -35,  -10,  7,
  98,       35,  -10,  1, 
  99,       35,  -10,  7,
  97,      -10,  -10,  1, 
  96,      -10,  -10,  7,
  97,       10,  -10,  1, 
  96,       10,  -10,  7,
  
  98,      -45,  -25,  1, 
  99,      -45,  -25,  7,
  98,       45,  -25,  1, 
  99,       45,  -25,  7,
  97,      -10,  -25,  1, 
  96,      -10,  -25,  7,
  97,       10,  -25,  1, 
  96,       10,  -25,  7,
  
#balcony
  95,       10,  -40, 3,
  95,      -10,  -40, 3, 
  95,       10,  -50, 3,
  95,      -10,  -50, 3

) 

p1 <- pendants %>% filter(sz==1)
p2 <- pendants %>% filter(sz==7)
p3 <- pendants %>% filter(sz==3)

ggplot() + 
    geom_segment(data=wall.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 
    geom_point(data=p2, aes(x=x, y=y, color=factor(sz), size=12) ) +
    geom_point(data=p1, aes(x=x, y=y, color=factor(sz), size=7) ) +
    geom_point(data=p3, aes(x=x, y=y, color=factor(sz), size= 8) ) +
    geom_text(data=p1, aes(x=x, y=y, label=Channel )) +
    geom_text(data=p3, aes(x=x, y=y, label=Channel ) ) +
    geom_text(data=p2, aes(x=x, y=y, label=Channel ), nudge_x=4, nudge_y=4) +
    geom_curve(data=thrust, aes(x=x,y=y, xend=xend, yend=yend), curvature=-0.4) +
    geom_segment(data=balc.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 

    coord_equal() + theme(legend.position="none") + scale_size_identity()
```


##Sconse
>TODO: Correct channels numbers. Positions are only guesses based on memory. 

```{r clpsconse}

sconse1 <- tribble(
  ~Item, ~Channel, ~x, ~y,
  1,           99, -38, 0,
  2,           99, -45, -9,
  3,           99, -53,  -18,
  4,           99, -49, -31,
  5,           99, -40, -40,
  6,           99, -32, -48
)
sconse2 <- sconse1 %>%
  mutate(Item=Item+6) %>%
  mutate(x = -x)

sconse <- rbind(sconse1, sconse2)

ggplot() + 
  geom_segment(data=wall.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 
  coord_equal() + 
  theme(legend.position="none") + 
  scale_size_identity() +
  geom_point(data=sconse, aes(x=x, y=y, size= 8), color="lightblue" ) +
  geom_curve(data=thrust, aes(x=x,y=y, xend=xend, yend=yend), curvature=-0.4) +
  geom_segment(data=balc.segments, aes(x=x,y=y, xend=xend, yend=yend) ) + 
  geom_text(data=sconse, aes(x=x, y=y, label=Channel ) ) 
```

##Under the Balcony
Detailed plot not shown. All lights are on Channel X. There are 24 Ketra pot lights. 

>TODO: Need to fill in channel number above.